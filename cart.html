<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Carrito ‚Äì Style Elegance Sport</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="top-announcement">
      üöö Env√≠o gratis en compras mayores a S/150
    </div>
    <header>
      <div class="logo">
        <img src="imagenes/logo.png" alt="Style Elegance Sport" />
      </div>
      <nav class="nav-links">
        <a href="index.html#inicio">Inicio</a>
        <a href="index.html#productos">Ropa</a>
        <a href="index.html#contacto">Contacto</a>
      </nav>
      <a href="index.html" class="header-emoji">üè† Volver</a>
      <div class="menu-toggle"><i class="fas fa-bars"></i></div>
    </header>

    <main style="padding: 2rem">
      <h2 style="text-align: center; margin-bottom: 1.5rem">
        Tu Carrito de Compras
      </h2>
      <table class="cart-table">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Precio unitario</th>
            <th>Cantidad</th>
            <th>Subtotal</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="cart-body"></tbody>
      </table>
      <div class="cart-summary">
        <p>Coste de productos: S/ <span id="sum-products">0.00</span></p>
        <p>Env√≠o: S/ <span id="sum-shipping">0.00</span></p>
        <hr />
        <p>
          <strong>Total a pagar: S/ <span id="sum-total">0.00</span></strong>
        </p>
      </div>
      <div class="cart-actions">
        <button id="btn-whatsapp" class="btn btn-primary">
          Enviar pedido por WhatsApp
        </button>
        <button id="btn-clear" class="btn btn-secondary">Vaciar carrito</button>
      </div>
    </main>

    <footer>
      <div class="social-footer">
        <a href="#"><i class="fab fa-facebook-f"></i></a>
        <a href="#"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-whatsapp"></i></a>
        <a href="#"><i class="fab fa-tiktok"></i></a>
      </div>
      <p>¬© 2025 Style Elegance Sport. Todos los derechos reservados.</p>
    </footer>

    <script>
      let cart = JSON.parse(localStorage.getItem("cart") || "[]");
      const cartBody = document.getElementById("cart-body");
      const sumProducts = document.getElementById("sum-products");
      const sumShipping = document.getElementById("sum-shipping");
      const sumTotal = document.getElementById("sum-total");
      const btnClear = document.getElementById("btn-clear");
      const btnWhats = document.getElementById("btn-whatsapp");

      function renderCart() {
        cartBody.innerHTML = "";
        let totalProd = 0;
        cart.forEach((item, idx) => {
          const subtotal = item.precio * item.cantidad;
          totalProd += subtotal;
          const tr = document.createElement("tr");
          tr.dataset.idx = idx;
          tr.innerHTML = `
            <td>
              <img src="${item.img}" alt="${item.nombre}"
                   style="width:50px;vertical-align:middle;margin-right:.5rem;">
              ${item.nombre} (${item.talla})
            </td>
            <td>S/ ${item.precio.toFixed(2)}</td>
            <td>
              <input type="number" min="1" value="${item.cantidad}"
                     data-idx="${idx}" class="qty-update" />
            </td>
            <td>S/ ${subtotal.toFixed(2)}</td>
            <td><button class="remove-item" data-idx="${idx}">&times;</button></td>
          `;
          cartBody.appendChild(tr);
        });
        const envio = totalProd >= 150 ? 0 : 15;
        sumProducts.textContent = totalProd.toFixed(2);
        sumShipping.textContent = envio.toFixed(2);
        sumTotal.textContent = (totalProd + envio).toFixed(2);

        document.querySelectorAll(".qty-update").forEach((input) => {
          input.onchange = (e) => {
            cart[e.target.dataset.idx].cantidad = parseInt(e.target.value, 10);
            saveAndRender();
          };
        });
        document.querySelectorAll(".remove-item").forEach((btn) => {
          btn.onclick = (e) => {
            cart.splice(e.target.dataset.idx, 1);
            saveAndRender();
          };
        });
      }

      function saveAndRender() {
        localStorage.setItem("cart", JSON.stringify(cart));
        renderCart();
      }

      btnClear.onclick = () => {
        if (!cart.length) return;
        if (!confirm("¬øVaciar todo el carrito?")) return;
        document
          .querySelectorAll("#cart-body tr")
          .forEach((row) => row.classList.add("fade-out"));
        setTimeout(() => {
          cart = [];
          saveAndRender();
        }, 500);
      };

      btnWhats.onclick = () => {
        if (!cart.length) return alert("Tu carrito est√° vac√≠o.");

        let texto = "¬°Hola! Quiero hacer un pedido:\n\n";
        cart.forEach((item) => {
          texto += `‚Ä¢ ${item.nombre} (${item.talla}) x${item.cantidad} = S/ ${(
            item.precio * item.cantidad
          ).toFixed(2)}\n\n`;
        });
        const totalProd = cart.reduce(
          (sum, i) => sum + i.precio * i.cantidad,
          0
        );
        const envio = totalProd >= 150 ? 0 : 15;
        texto += `Subtotal: S/ ${totalProd.toFixed(2)}\n`;
        texto += `Env√≠o: S/ ${envio.toFixed(2)}\n`;
        texto += `*Total: S/ ${(totalProd + envio).toFixed(2)}*\n\n`;
        texto += "¬øPodr√≠an confirmarme disponibilidad y forma de pago? Gracias.";

        const numero = "51979380585";
        window.location.href = `https://api.whatsapp.com/send?phone=${numero}&text=${encodeURIComponent(
          texto
        )}`;
      };

      renderCart();
    </script>
  </body>
</html>
